# MyWineMemory 仕様書 v3.0

## 1. プロジェクト概要

### 1.1 基本情報

**サイト名**: MyWineMemory  
**URL**: my-wine-memory.himazi.com  
**サイトの目的・コンセプト**:
- 飲んだワインを記録に残せる
- ワインの基礎知識を学べる
- 自分がどんなワインを飲んでどう思ったかを振り返れる

**ターゲットユーザー**: Dラボでワインを飲み始めた人たち  
**想定利用シーン**:
- ワインを飲んでいるときにメモ代わりにスマホで入力
- あの時飲んだワインを思い出しながら記録
- 通勤時間などの暇な時間にあなたの弱いところをクイズとして解く

### 1.2 実装状況

**プロジェクトステータス**: 実装完了（v3.0）  
**技術スタック**: 
- React 18 + TypeScript + Vite
- Firebase (Firestore, Authentication, Storage, Hosting)
- 全画面対応レスポンシブデザイン

## 2. 機能要件

### 2.1 ユーザー管理機能

**認証システム**:
- Googleアカウント認証（OAuth）
- ゲストモード対応（ローカルストレージ）
- パスワードリセット: なし（Google認証のため）

**プロフィール管理**:
- ニックネームの設定・変更機能
- プロフィール画像（Googleアカウントから取得）
- 獲得バッジの表示
- 統計情報の表示（記録数、連続記録日数など）

### 2.2 ワイン記録機能（新三段階ワークフロー）

#### 2.2.1 新ワークフロー
**①ワイン選択/追加 → ②記録保存 → ③日付ごとの記録確認**

**Step 1: ワイン選択** (`/select-wine`)
- 既存ワインマスターデータベースから検索・選択
- 人気ワインの表示
- 新しいワインの追加（ワインマスターに登録）
- `/add-tasting-record/{wineId}` への遷移

**Step 2: テイスティング記録入力** (`/add-tasting-record/:wineId`)
- 選択したワインの基本情報表示
- 個人的なテイスティング体験の記録
- クイック/詳細モードの選択
- TastingRecordコレクションへの保存

**Step 3: 記録確認** (`/records` & `/wine-detail/:wineId`)
- **記録一覧**: ワインマスターごとにグループ化された表示
- **ワイン詳細**: 個別ワインの時系列テイスティング記録
- 記録の編集・削除機能

#### 2.2.2 データベース構造（分離アーキテクチャ）

**WineMaster Collection** (`wines_master`):
```typescript
{
  id: string,
  wineName: string,         // 必須
  producer: string,         // 必須
  country: string,          // 必須
  region: string,           // 必須
  vintage?: number,         // 任意
  grapeVarieties?: string[], // 任意
  wineType?: 'red' | 'white' | 'rose' | 'sparkling' | 'dessert' | 'fortified',
  alcoholContent?: number,   // 任意
  winemaker?: string,       // 任意
  referenceCount: number,   // 参照カウント
  createdAt: Date,
  createdBy: string
}
```

**TastingRecord Collection** (`tasting_records`):
```typescript
{
  id: string,
  userId: string,           // 必須
  wineId: string,           // WineMasterへの参照
  overallRating: number,    // 0.0-10.0スライダー評価
  tastingDate: Date,        // 必須
  recordMode: 'quick' | 'detailed',
  notes?: string,           // 個人的メモ
  price?: number,           // 購入価格
  purchaseLocation?: string, // 購入場所
  images?: string[],        // 写真URL配列
  environment?: object,     // 環境情報
  detailedAnalysis?: object, // 詳細分析（詳細モード）
  createdAt: Date,
  updatedAt: Date,
  isPublic: boolean
}
```

#### 2.2.3 記録モード

**クイックモード**:
- 総合評価（0.0-10.0）
- テイスティング日
- 簡単なメモ

**詳細モード**:
- 外観の詳細分析（色調、濃淡、透明度、粘性）
- 香りの段階別分析（第一印象、スワリング後、カテゴリ別）
- 味わいの段階別分析（アタック、中盤、フィニッシュ）
- 構成要素分析（酸味、タンニン、甘味、ボディ）
- 環境・状況情報
- 複数画像アップロード

### 2.3 ナビゲーション構造（実装済み）

```
/ (ホーム)
├── /select-wine                     # Step 1: ワイン選択
├── /add-tasting-record/:wineId      # Step 2: 新規テイスティング記録
├── /edit-tasting-record/:recordId   # テイスティング記録編集
├── /records                         # Step 3: 記録一覧
├── /wine-detail/:wineId            # 個別ワイン詳細
├── /quiz                           # クイズシステム
├── /quiz/play/:difficulty          # クイズゲーム
├── /stats                          # ユーザー統計
└── /profile                        # ユーザープロフィール
```

### 2.4 検索・表示機能

**記録一覧画面** (`/records`):
- ワインマスターデータごとの表示
- 各ワインのテイスティング記録数表示
- 最新テイスティング記録日時表示
- 平均評価の表示

**ワイン詳細画面** (`/wine-detail/:wineId`):
- ワインマスターの基本情報
- 日付順テイスティング記録一覧
- テイスティング統計（記録数、平均評価、最高評価）
- 個別記録の詳細表示・編集・削除

### 2.5 ゲストモード機能

**ゲストモード特徴**:
- ローカルストレージでの一時データ保存
- ログイン促進UI
- ログイン時のデータ移行機能（予定）

### 2.6 クイズ機能（Duolingo参考）

#### 2.6.1 問題構成
- **問題数**: 1000問（JSONファイル管理）
- **難易度**: 10段階
- **内容**: ソムリエ試験準拠
- **形式**: 選択式

#### 2.6.2 学習システム
- 難易度別ランダム出題
- 復習機能（間違えた問題の再出題）
- ライフシステム（5つのハート）
- パーソナライズドクイズ（LLM評価）

### 2.7 ゲーミフィケーション機能

#### 2.7.1 バッジシステム

**記録数バッジ**（12段階）:
🥉 ビギナー（1本）→ スターター（3本）→ ルーキー（5本）→ 🥈 愛好家（10本）→ 常連（25本）→ 通（50本）→ 🥇 エキスパート（100本）→ プロ（200本）→ 💎 マスター（500本）→ グランドマスター（1000本）→ 👑 レジェンド（2000本）→ 🌟 神（5000本）

**連続記録バッジ**（10段階）:
🔥 3日→7日→14日→30日→50日 → ⭐ 100日→200日→365日 → 💫 500日 → 🌟 1000日

**クイズバッジ**（15段階）:
📚 入門者（10問）→ 初級者（25問）→ 中級者（50問）→ 📖 上級者（100問）→ 優等生（200問）→ 🎓 秀才（500問）→ 天才（1000問）→ 🧠 賢者（2000問）
+ 連続正解バッジ（⚡ 5問→10問→20問）+ 完全制覇バッジ（🏆 各難易度）

#### 2.7.2 XP・レベルシステム
- **ワイン記録**: 10XP（クイック）/ 20XP（詳細）
- **クイズ正解**: 5XP
- **デイリーゴール達成**: 50XP
- **バッジ獲得**: 100XP
- **レベル**: 1～100（XP累積）

#### 2.7.3 目標設定機能
- **デイリーゴール**: ワイン記録1本/日、クイズ5問/日
- **ストリーク機能**: 連続記録日数追跡
- **ストリークフリーズ**: 1日スキップ可能

### 2.8 統計・分析機能

**基本統計**:
- 総記録数
- 月別記録数グラフ
- 国別・品種別円グラフ
- 平均評価
- 香りチャート（レーダーチャート）

### 2.9 データ管理機能

**下書き保存機能**:
- 30秒ごと自動保存
- 最大5件保持
- ホーム画面での下書き一覧表示

**ゴミ箱機能**:
- 削除後3日間保持
- 復元・完全削除機能
- 自動完全削除

## 3. 非機能要件

### 3.1 対応環境

**対応デバイス**: PC、スマートフォン、タブレット  
**対応ブラウザ**:
- Chrome系（推奨）
- Safari（対応）
- Edge（非対応）

**レスポンシブデザイン**:
- 全画面対応（100vw）
- モバイルファースト設計
- マルチプラットフォーム対応

### 3.2 パフォーマンス要件
- 初回読み込み3秒以内
- 画像最適化（WebP、遅延読み込み）
- PWA対応

### 3.3 セキュリティ要件
- Google OAuth認証
- HTTPS通信
- ユーザーデータ分離

## 4. デザイン要件

### 4.1 デザインコンセプト
- **ライトモード**: ワイン畑イメージの明るいデザイン
- **ダークモード**: バー雰囲気の落ち着いた大人デザイン
- **ゲーミフィケーション**: Duolingo風カラフルUI

### 4.2 カラースキーム

**ライトモード**:
- メインカラー: ワインレッド（#722F37）
- サブカラー: 緑（#2E7D32）
- 背景: 明るいベージュ（#FFF8E1）

**ダークモード**:
- メインカラー: 深いバーガンディ（#4A0E0E）
- サブカラー: ゴールド（#FFD700）
- 背景: ダークグレー（#1A1A1A）

### 4.3 レイアウト（実装済み）

**ナビゲーション**: 
- 下部固定タブバー（モバイル）
- レスポンシブ対応

**ページ構成**:
- ホーム（ダッシュボード、クイックアクション）
- 記録（ワインマスター一覧）
- クイズ（学習システム）
- 統計（データ分析）
- プロフィール（バッジ、設定）

## 5. システム構成（実装済み）

### 5.1 技術スタック
- **フロントエンド**: React 18 + TypeScript + Vite
- **バックエンド**: Firebase
- **データベース**: Firebase Firestore
- **ホスティング**: Firebase Hosting
- **認証**: Firebase Authentication
- **ストレージ**: Firebase Storage

### 5.2 外部API
- OpenRouter/Groq（パーソナライズドクイズ用LLM）

### 5.3 開発環境
- **バージョン管理**: GitHub
- **CI/CD**: GitHub Actions
- **開発支援**: Claude Code

## 6. ファイル構造（実装済み）

```
my-wine-memory/src/
├── components/          # 再利用可能UIコンポーネント
│   ├── BottomNavigation.tsx
│   ├── WineCard.tsx
│   ├── LoadingSpinner.tsx
│   └── ErrorMessage.tsx
├── pages/              # ルートコンポーネント
│   ├── Home.tsx        # ダッシュボード
│   ├── SelectWine.tsx  # Step 1: ワイン選択
│   ├── AddTastingRecord.tsx  # Step 2: テイスティング記録
│   ├── Records.tsx     # Step 3: 記録一覧
│   ├── WineDetail.tsx  # ワイン詳細（時系列記録）
│   ├── Quiz.tsx & QuizGame.tsx
│   └── Stats.tsx & Profile.tsx
├── hooks/              # カスタムReactフック
│   └── useAsyncOperation.ts
├── services/           # Firebaseサービス
│   ├── wineMasterService.ts     # WineMaster CRUD
│   ├── tastingRecordService.ts  # TastingRecord CRUD
│   ├── userService.ts & guestDataService.ts
│   └── wineService.ts          # 旧版サービス
├── contexts/           # React Context
│   └── AuthContext.tsx
├── types/              # TypeScript型定義
│   └── index.ts        # WineMaster, TastingRecord
├── App.tsx             # メインルーティング
├── App.css             # 全画面対応スタイル
└── main.tsx            # アプリケーションエントリーポイント
```

## 7. 予算・運用

### 7.1 開発費用
- **開発費**: 0円～1,000円（Claude Code活用）

### 7.2 運用費用（月額）
- Firebase利用料: ～500円
- LLM API利用料: ～300円
- ドメイン維持費: ～200円
- **合計**: 月額1,000円以内

## 8. 今後の検討事項

### 8.1 近期実装予定
- パーソナライズドクイズのLLM連携
- PWA通知機能

### 8.2 将来機能
- 有料プラン（LLMアドバイス、高度分析）
- AI画像認識（ラベル読み取り）
- ワインショップ提携
- コミュニティ機能拡張

## 9. 変更履歴

### v3.0（2024年実装完了）
- 三段階ワークフローの完全実装
- WineMaster + TastingRecord分離アーキテクチャ
- 全画面対応レスポンシブデザイン
- ゲストモード対応
- 新ナビゲーション構造

### v2.0
- 基本機能仕様策定

### v1.0
- 初期仕様書作成
# Firebase Console Configuration Checklist

## üîç Required Configurations for iPhone/Safari Google Login

### 1. Authentication - Authorized Domains

**Location:** Firebase Console ‚Üí Authentication ‚Üí Settings ‚Üí Authorized domains

**Required Domains:**
- ‚úÖ `my-wine-memory.himazi.com` (production custom domain)
- ‚úÖ `mywinememory-4bdf9.firebaseapp.com` (Firebase default)
- ‚úÖ `mywinememory-4bdf9.web.app` (Firebase Web App)
- ‚úÖ `localhost` (development only)

**How to Add:**
1. Click "Add domain"
2. Enter domain name
3. Click "Add"

---

### 2. Authentication - Google Sign-In Provider

**Location:** Firebase Console ‚Üí Authentication ‚Üí Sign-in method ‚Üí Google

**Required Settings:**
- ‚úÖ Status: **Enabled**
- ‚úÖ Project public-facing name: `MyWineMemory`
- ‚úÖ Project support email: Your email
- ‚úÖ Web SDK configuration: Expanded and verified

**OAuth Client Configuration:**
- Client ID: Auto-generated by Firebase
- Client Secret: Auto-generated by Firebase
- Note: These are also in Google Cloud Console

---

### 3. Hosting - Custom Domain Setup

**Location:** Firebase Console ‚Üí Hosting ‚Üí Domains

**Required Configuration:**

**Domain:** `my-wine-memory.himazi.com`
- ‚úÖ Status: **Connected**
- ‚úÖ SSL Certificate: **Active**
- ‚úÖ DNS Records: **Verified**

**DNS Configuration (for reference):**
```
Type: A
Name: my-wine-memory
Value: [Firebase IP addresses]

Type: TXT
Name: my-wine-memory
Value: [Firebase verification code]
```

---

### 4. Google Cloud Console - OAuth Consent Screen

**Location:** Google Cloud Console ‚Üí APIs & Services ‚Üí OAuth consent screen

**Required Settings:**
- ‚úÖ User Type: **External** (for public app)
- ‚úÖ App name: `MyWineMemory`
- ‚úÖ User support email: Your email
- ‚úÖ App domain: `my-wine-memory.himazi.com`
- ‚úÖ Authorized domains: `himazi.com`
- ‚úÖ Developer contact information: Your email

---

### 5. Google Cloud Console - OAuth Credentials

**Location:** Google Cloud Console ‚Üí APIs & Services ‚Üí Credentials

**Find:** OAuth 2.0 Client IDs (created automatically by Firebase)

**Authorized JavaScript origins:**
```
https://my-wine-memory.himazi.com
https://mywinememory-4bdf9.firebaseapp.com
https://mywinememory-4bdf9.web.app
http://localhost:5173 (development)
```

**Authorized redirect URIs:**
```
https://my-wine-memory.himazi.com/__/auth/handler
https://mywinememory-4bdf9.firebaseapp.com/__/auth/handler
https://mywinememory-4bdf9.web.app/__/auth/handler
http://localhost:5173/__/auth/handler (development)
```

**‚ö†Ô∏è Important:**
- Firebase automatically manages these URIs when you enable Google Sign-In
- If you manually created an OAuth Client, you need to add these URIs yourself
- The `/__/auth/handler` path is critical for redirect-based auth

---

### 6. Environment Variables

**For Production Deployment:**

```bash
# Critical: Use custom domain for authDomain
VITE_FIREBASE_API_KEY=your-api-key
VITE_FIREBASE_AUTH_DOMAIN=my-wine-memory.himazi.com  # ‚Üê MUST be custom domain
VITE_FIREBASE_PROJECT_ID=mywinememory-4bdf9
VITE_FIREBASE_STORAGE_BUCKET=mywinememory-4bdf9.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=your-sender-id
VITE_FIREBASE_APP_ID=your-app-id
```

**Common Mistake:**
```bash
# ‚ùå WRONG - causes third-party cookie issues
VITE_FIREBASE_AUTH_DOMAIN=mywinememory-4bdf9.firebaseapp.com

# ‚úÖ CORRECT - matches hosting domain
VITE_FIREBASE_AUTH_DOMAIN=my-wine-memory.himazi.com
```

---

### 7. Firestore Security Rules

**Location:** Firebase Console ‚Üí Firestore Database ‚Üí Rules

**Verify auth is properly configured:**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users can only access their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Public profiles (if applicable)
    match /public_profiles/{userId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

---

### 8. Verification Steps

**After Configuration:**

1. **Test Custom Domain Access:**
   ```
   Open: https://my-wine-memory.himazi.com
   Expected: Site loads correctly
   ```

2. **Test Auth Handler Endpoint:**
   ```
   Open: https://my-wine-memory.himazi.com/__/auth/handler
   Expected: Firebase auth handler page (blank is OK)
   ```

3. **Check Browser Console:**
   ```javascript
   // In site console
   console.log(firebase.app().options.authDomain)
   // Expected: "my-wine-memory.himazi.com"
   ```

4. **Test Login Flow:**
   - Click "Google„Åß„É≠„Ç∞„Ç§„É≥"
   - Redirects to Google OAuth
   - Returns to site after authorization
   - User is logged in
   - No console errors

---

## üêõ Troubleshooting

### Issue: "auth/unauthorized-domain"

**Solution:**
1. Go to Firebase Console ‚Üí Authentication ‚Üí Settings ‚Üí Authorized domains
2. Add the domain causing the error
3. Wait 5-10 minutes for propagation
4. Try again

### Issue: Redirect goes to wrong domain

**Check:**
1. `authDomain` in Firebase config matches custom domain
2. Rebuild app after changing environment variables
3. Clear browser cache

### Issue: "auth/web-storage-unsupported"

**Cause:** Safari private browsing mode

**Solution:**
- App now detects this and shows user-friendly error
- Instruct user to use normal browsing mode

### Issue: OAuth consent screen shows error

**Check:**
1. Google Cloud Console ‚Üí OAuth consent screen
2. Verify all required fields are filled
3. Ensure app domain matches hosting domain
4. Check authorized domains list

---

## üìã Quick Verification Checklist

Before deploying:

- [ ] Custom domain connected in Firebase Hosting
- [ ] SSL certificate active
- [ ] Google Sign-In enabled in Authentication
- [ ] All domains in Authorized domains list
- [ ] `authDomain` set to custom domain in env vars
- [ ] OAuth redirect URIs include custom domain
- [ ] Build and deploy with correct env vars
- [ ] Test on iPhone Safari
- [ ] Test on desktop Safari
- [ ] Test in private browsing mode (expect graceful error)
- [ ] Check console logs for auth flow

---

## üéØ Most Common Fix

**85% of issues solved by:**

1. Setting `VITE_FIREBASE_AUTH_DOMAIN=my-wine-memory.himazi.com`
2. Rebuilding: `npm run build`
3. Deploying: `firebase deploy`

**Estimated fix time:** 10-15 minutes

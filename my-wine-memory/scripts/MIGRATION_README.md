# Quiz Migration Guide

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ã‚¯ã‚¤ã‚ºæ©Ÿèƒ½ã®å„ç¨®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1: ç„¡é™ãƒ¢ãƒ¼ãƒ‰ã¸ã®ç§»è¡Œ

æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç„¡é™ãƒ¢ãƒ¼ãƒ‰ï¼ˆä½“åŠ›åˆ¶é™ãªã—ï¼‰ã«ç§»è¡Œã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

### æ–¹æ³•1: Firebase Admin SDK ã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ãƒ»ä¸€æ‹¬å‡¦ç†ï¼‰

### å‰ææ¡ä»¶

1. **Firebase Admin SDK ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   cd my-wine-memory
   npm install --save-dev firebase-admin
   ```

2. **ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®å–å¾—**

   a. [Firebase Console](https://console.firebase.google.com/) ã‚’é–‹ã

   b. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ

   c. ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã€ï¼ˆæ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ï¼‰â†’ã€Œã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€

   d. ã€Œæ–°ã—ã„ç§˜å¯†éµã®ç”Ÿæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯

   e. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `service-account-key.json` ã¨ã—ã¦ `my-wine-memory/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜

   âš ï¸ **é‡è¦**: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ©Ÿå¯†æƒ…å ±ã§ã™ã€‚çµ¶å¯¾ã«Gitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„ï¼ˆ.gitignoreã«å«ã¾ã‚Œã¦ã„ã¾ã™ï¼‰

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

```bash
cd my-wine-memory
node scripts/migrate-quiz-mode.js
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ï¼š
- âœ… `quizMode` ãŒæœªè¨­å®šã®å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œå‡º
- âœ… æ›´æ–°å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
- âœ… 5ç§’é–“ã®ç¢ºèªæ™‚é–“ï¼ˆCtrl+C ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½ï¼‰
- âœ… ãƒãƒƒãƒå‡¦ç†ã§åŠ¹ç‡çš„ã«æ›´æ–°
- âœ… é€²æ—çŠ¶æ³ã‚’è¡¨ç¤º

### å®Ÿè¡Œä¾‹

```
=== Quiz Mode Migration ===
This script will update all users without quizMode to "infinite" mode

ğŸ“¥ Fetching all users...
Found 15 total users

Found 12 users without quizMode

Users to be updated:
  1. John Doe (john@example.com)
  2. Jane Smith (jane@example.com)
  ...

âš ï¸  This will set quizMode="infinite" for all these users
Starting in 5 seconds... Press Ctrl+C to cancel

ğŸ”„ Starting migration...

âœ… Updated 12/12 users

=================================
âœ¨ Migration complete!
   Updated 12 users to infinite mode
=================================
```

---

## æ–¹æ³•2: è‡ªå‹•ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼‰

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ããªã„å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ãŸæ™‚ã«è‡ªå‹•çš„ã«è¨­å®šã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã“ã®æ–¹æ³•ã§ã¯ `AuthContext.tsx` ã‚’ä¿®æ­£ã—ã¦ã€ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã« `quizMode` ãŒæœªè¨­å®šã®å ´åˆã«è‡ªå‹•çš„ã« `'infinite'` ã‚’è¨­å®šã—ã¾ã™ã€‚

è©³ç´°ãŒå¿…è¦ãªå ´åˆã¯ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚

---

## æ–¹æ³•3: Firestore Console ã‹ã‚‰æ‰‹å‹•æ›´æ–°

å°‘æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆã€Firebase Consoleã‹ã‚‰æ‰‹å‹•ã§æ›´æ–°ã§ãã¾ã™ï¼š

1. [Firebase Console](https://console.firebase.google.com/) ã‚’é–‹ã
2. ã€ŒFirestore Databaseã€ã‚’é¸æŠ
3. `users` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‹ã
4. å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç·¨é›†
5. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ : `quizMode` = `"infinite"` (æ–‡å­—åˆ—å‹)

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: Cannot find module 'firebase-admin'
```bash
npm install --save-dev firebase-admin
```

### ã‚¨ãƒ©ãƒ¼: Cannot find module '../service-account-key.json'
ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€æ­£ã—ã„å ´æ‰€ã«é…ç½®ã—ã¦ãã ã•ã„ã€‚

### ã‚¨ãƒ©ãƒ¼: Permission denied
ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ååˆ†ãªæ¨©é™ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

---

## ç¢ºèªæ–¹æ³•

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¯ã‚¤ã‚ºãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œâ™¾ï¸ ç„¡é™ãƒ¢ãƒ¼ãƒ‰ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹
3. é–“é•ãˆã¦ã‚‚ä½“åŠ›ãŒæ¸›ã‚‰ãªã„
4. ä½“åŠ›0ã§ã‚‚ã‚¯ã‚¤ã‚ºã‚’ç¶šã‘ã‚‰ã‚Œã‚‹

## package.json ã¸ã®è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ npm ã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å ´åˆï¼š

```json
{
  "scripts": {
    "migrate:quiz-mode": "node scripts/migrate-quiz-mode.js"
  }
}
```

å®Ÿè¡Œï¼š
```bash
npm run migrate:quiz-mode
```

---

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³2: å…¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒ³ãƒ­ãƒƒã‚¯

æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨ã‚¯ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã‚’ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

### å‰ææ¡ä»¶

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³1ã¨åŒã˜ï¼ˆFirebase Admin SDK ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ãŒå¿…è¦ï¼‰

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

```bash
cd my-wine-memory
npm run migrate:unlock-levels
```

ã¾ãŸã¯ï¼š

```bash
node scripts/unlock-all-levels.js
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ï¼š
- âœ… `isUnlocked=false` ã®å…¨ãƒ¬ãƒ™ãƒ«é€²æ—ã‚’æ¤œå‡º
- âœ… æ›´æ–°å¯¾è±¡ã®ãƒ¬ãƒ™ãƒ«ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«è¡¨ç¤º
- âœ… 5ç§’é–“ã®ç¢ºèªæ™‚é–“ï¼ˆCtrl+C ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½ï¼‰
- âœ… ãƒãƒƒãƒå‡¦ç†ã§åŠ¹ç‡çš„ã«æ›´æ–°
- âœ… é€²æ—çŠ¶æ³ã‚’è¡¨ç¤º

### å®Ÿè¡Œä¾‹

```
=== Unlock All Levels Migration ===
This script will unlock all quiz levels for all users

ğŸ“¥ Fetching all level progress documents...
Found 50 level progress documents

Found 35 locked levels to unlock

Levels to be unlocked:
  User 12345678...: Levels 2, 3, 4, 5
  User 87654321...: Levels 2, 3
  ...

âš ï¸  This will set isUnlocked=true for all these level progress documents
Starting in 5 seconds... Press Ctrl+C to cancel

ğŸ”„ Starting migration...

âœ… Updated 35/35 level progress documents

=================================
âœ¨ Migration complete!
   Unlocked 35 levels across 8 users
=================================
```

### ç¢ºèªæ–¹æ³•

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¯ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«é¸æŠç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹
2. å…¨ã¦ã®ãƒ¬ãƒ™ãƒ«ãŒğŸ”’ãªã—ã§è¡¨ç¤ºã•ã‚Œã‚‹
3. ä»»æ„ã®ãƒ¬ãƒ™ãƒ«ã«ç›´æ¥æŒ‘æˆ¦ã§ãã‚‹
4. ã€Œã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„

---

## æ¨å¥¨å®Ÿè¡Œé †åº

ä¸¡æ–¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆï¼š

1. `npm run migrate:quiz-mode` - ç„¡é™ãƒ¢ãƒ¼ãƒ‰ã¸ã®ç§»è¡Œ
2. `npm run migrate:unlock-levels` - å…¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
3. service-account-key.json ã‚’å‰Šé™¤ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ï¼‰

æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªå‹•çš„ã«ï¼š
- ç„¡é™ãƒ¢ãƒ¼ãƒ‰ï¼ˆquizMode='infinite'ï¼‰
- å…¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ï¼ˆisUnlocked=trueï¼‰

ã§ä½œæˆã•ã‚Œã¾ã™ã€‚

# MyWineMemory ç·åˆæŠ€è¡“ä»•æ§˜æ›¸ v5.0

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### 1.1 åŸºæœ¬æƒ…å ±
**ã‚µã‚¤ãƒˆå**: MyWineMemory  
**URL**: my-wine-memory.himazi.com  
**ã‚³ãƒ³ã‚»ãƒ—ãƒˆ**: é£²ã‚“ã ãƒ¯ã‚¤ãƒ³ã‚’è¨˜éŒ²ã—ã€ã‚¯ã‚¤ã‚ºã§å­¦ç¿’ã§ãã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³  
**ãƒ‡ã‚¶ã‚¤ãƒ³**: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒï¼ˆãƒãƒ¼é›°å›²æ°—ã®è½ã¡ç€ã„ãŸå¤§äººãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰

### 1.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React 18 + TypeScript + Vite
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Firebase (Firestore, Authentication, Storage, Hosting, Messaging)
- **çŠ¶æ…‹ç®¡ç†**: React Context APIï¼ˆèªè¨¼ãƒ»ã‚¨ãƒ©ãƒ¼ï¼‰
- **PWA**: Vite PWA plugin + Workbox
- **æ±ºæ¸ˆ**: Stripeï¼ˆå®Ÿè£…äºˆå®šï¼‰
- **å¤–éƒ¨API**: OpenRouter/Groqï¼ˆLLMé€£æºï¼‰
- **ã‚°ãƒ©ãƒ•**: Chart.js + react-chartjs-2
- **ã‚¨ãƒ©ãƒ¼è¿½è·¡**: Sentryï¼ˆæº–å‚™æ¸ˆã¿ï¼‰

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### 2.1 è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼**: ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹FirebaseæŠ½è±¡åŒ–
- **Context API**: èªè¨¼çŠ¶æ…‹ãƒ»ã‚¨ãƒ©ãƒ¼ã®2ã¤ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯**: éåŒæœŸæ“ä½œãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒªãƒ¼**: ä¸­å¤®é›†æ¨©çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 2.2 ãƒãƒ³ãƒ‰ãƒ«æœ€é©åŒ–æˆ¦ç•¥
```typescript
// ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²æˆ¦ç•¥ï¼ˆvite.config.tsï¼‰
{
  'vendor-react': Reacté–¢é€£ãƒ©ã‚¤ãƒ–ãƒ©ãƒª,
  'vendor-firebase': Firebase SDK,
  'vendor-charts': Chart.jsé–¢é€£,
  'page-wine-recording': SelectWine + AddTastingRecord,
  'page-wine-viewing': Records + WineDetail,
  'page-quiz': Quiz + QuizGame,
  'services-wine': ãƒ¯ã‚¤ãƒ³é–¢é€£ã‚µãƒ¼ãƒ“ã‚¹,
  'services-core': firebase.ts + èªè¨¼é–¢é€£
}
```

## 3. ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆéæ¸¡æœŸä»•æ§˜ï¼‰

### 3.1 TastingRecord Collection (`tasting_records`)
```typescript
interface TastingRecord {
  id: string;
  userId: string;
  wineId: string;           // WineMasterå‚ç…§ï¼ˆå°†æ¥ç”¨ï¼‰
  
  // åŸ‹ã‚è¾¼ã¿ãƒ¯ã‚¤ãƒ³åŸºæœ¬æƒ…å ±ï¼ˆç¾è¡Œä»•æ§˜ï¼‰
  wineName: string;         // å¿…é ˆ
  producer: string;         // å¿…é ˆï¼ˆç”Ÿç”£è€…ãƒ»ãƒ¯ã‚¤ãƒŠãƒªãƒ¼åï¼‰
  country: string;          // å¿…é ˆï¼ˆé¸æŠå¼ï¼‰
  region: string;           // å¿…é ˆï¼ˆcountryé€£å‹•é¸æŠå¼ï¼‰
  vintage?: number;
  grapeVarieties?: string[];
  wineType?: 'red' | 'white' | 'rose' | 'sparkling' | 'dessert' | 'fortified';
  alcoholContent?: number;
  soilInfo?: string;
  climate?: string;         // wineTypeé€£å‹•é¸æŠå¼
  wineHistory?: string;
  winemaker?: string;       // é†¸é€ å®¶åï¼ˆproducerã¨åŒºåˆ¥ï¼‰
  price?: number;           // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªæƒ…å ±ãªã®ã§ã€å…¬é–‹è¨­å®šã«ãªã£ã¦ã„ãªã„å ´åˆã¯éå…¬é–‹
  purchaseLocation?: string;// ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªæƒ…å ±ãªã®ã§ã€å…¬é–‹è¨­å®šã«ãªã£ã¦ã„ãªã„å ´åˆã¯éå…¬é–‹
  links?: string[];         // å‚è€ƒãƒªãƒ³ã‚¯é…åˆ—ï¼ˆæœ€å¤§5å€‹ï¼‰
  
  // å¿…é ˆãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±
  overallRating: number;    // 0.0-10.0
  tastingDate: Date | string; //ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å½“æ—¥
  recordMode: 'quick' | 'detailed';
  
  // ä»˜åŠ æƒ…å ±
  notes?: string;
  images?: string[];        // æœ€å¤§5æšï¼ˆç„¡æ–™ï¼š1æšã€æœ‰æ–™ï¼š4æšï¼‰
  
  // è©³ç´°åˆ†æï¼ˆdetailed modeé™å®šï¼‰
  detailedAnalysis?: {
    appearance?: {
      color: string;
      intensity: number;      // 1-5
      clarity: string;
      viscosity: string;
    };
    aroma?: {
      firstImpression: { intensity: number; notes: string };
      afterSwirling: { intensity: number; notes: string };
      categories: {
        fruity: number;       // 0-4ã‚¹ã‚±ãƒ¼ãƒ«
        floral: number;
        spicy: number;
        herbal: number;
        earthy: number;
        woody: number;
        other: number;
      };
      specificAromas: string[];
    };
    taste?: {
      attack: { intensity: number; notes: string };
      development: { complexity: number; notes: string };
      finish: { length: number; seconds?: number; notes: string };
    };
    structure?: {
      acidity: { intensity: number; type?: string[] };
      tannins: { intensity: number; texture?: string[] };
      sweetness: number;      // 1-5
      body: number;           // 1-5
    };
    timeBasedNotes?: {
      time: string;
      temperature?: number;
      notes: string;
    }[];
  };
  
  // ç’°å¢ƒãƒ»ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
  environment?: {
    temperature?: number;
    decanted?: boolean;
    glassType?: string;       // wineTypeé€£å‹•é¸æŠå¼ï¼ˆç”»åƒä»˜ãï¼‰
    lighting?: string;
    mood?: string;
    companions?: string;
    occasion?: string;
  };
  
  // éå»è¨˜éŒ²å¼•ç”¨æƒ…å ±
  citations?: {
    sourceRecordId: string;   // å¼•ç”¨å…ƒè¨˜éŒ²ID
    citedFields: string[];    // å¼•ç”¨ã—ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å
    citedAt: Date;           // å¼•ç”¨æ—¥æ™‚
    partialText?: string;    // éƒ¨åˆ†å¼•ç”¨ã®å ´åˆã®ãƒ†ã‚­ã‚¹ãƒˆ
  }[];
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  isPublic: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

### 3.2 é¸æŠå¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å®šæ•°å®šç¾©
```typescript
// å›½åˆ¥åœ°åŸŸãƒãƒƒãƒ”ãƒ³ã‚°
const WINE_REGIONS: Record<string, string[]> = {
  'ãƒ•ãƒ©ãƒ³ã‚¹': ['ãƒœãƒ«ãƒ‰ãƒ¼', 'ãƒ–ãƒ«ã‚´ãƒ¼ãƒ‹ãƒ¥', 'ã‚·ãƒ£ãƒ³ãƒ‘ãƒ¼ãƒ‹ãƒ¥', 'ãƒ­ãƒ¼ãƒŒ', 'ãƒ­ãƒ¯ãƒ¼ãƒ«', 'ã‚¢ãƒ«ã‚¶ã‚¹', 'ãƒ©ãƒ³ã‚°ãƒ‰ãƒƒã‚¯'],
  'ã‚¤ã‚¿ãƒªã‚¢': ['ãƒˆã‚¹ã‚«ãƒ¼ãƒŠ', 'ãƒ”ã‚¨ãƒ¢ãƒ³ãƒ†', 'ãƒ´ã‚§ãƒãƒˆ', 'ã‚·ãƒãƒªã‚¢', 'ãƒ—ãƒ¼ãƒªã‚¢', 'ãƒãƒ«ã‚±', 'ã‚¦ãƒ³ãƒ–ãƒªã‚¢'],
  'ã‚¹ãƒšã‚¤ãƒ³': ['ãƒªã‚ªãƒ', 'ãƒªãƒ™ãƒ©ãƒ»ãƒ‡ãƒ«ãƒ»ãƒ‰ã‚¥ã‚¨ãƒ­', 'ãƒ—ãƒªã‚ªãƒ©ãƒˆ', 'ãƒªã‚¢ã‚¹ãƒ»ãƒã‚¤ã‚·ãƒ£ã‚¹', 'ãƒ˜ãƒ¬ã‚¹'],
  'ãƒ‰ã‚¤ãƒ„': ['ãƒ¢ãƒ¼ã‚¼ãƒ«', 'ãƒ©ã‚¤ãƒ³ã‚¬ã‚¦', 'ãƒ•ã‚¡ãƒ«ãƒ„', 'ãƒãƒ¼ãƒ‡ãƒ³', 'ãƒ´ãƒ¥ãƒ«ãƒ†ãƒ³ãƒ™ãƒ«ã‚¯'],
  'ã‚¢ãƒ¡ãƒªã‚«': ['ãƒŠãƒ‘ãƒ»ãƒ´ã‚¡ãƒ¬ãƒ¼', 'ã‚½ãƒãƒ', 'ãƒ‘ã‚½ãƒ»ãƒ­ãƒ–ãƒ¬ã‚¹', 'ã‚ªãƒ¬ã‚´ãƒ³', 'ãƒ¯ã‚·ãƒ³ãƒˆãƒ³'],
  'ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢': ['ãƒãƒ­ãƒƒã‚µãƒ»ãƒ´ã‚¡ãƒ¬ãƒ¼', 'ãƒãƒ³ã‚¿ãƒ¼ãƒ»ãƒ´ã‚¡ãƒ¬ãƒ¼', 'ãƒãƒ¼ã‚¬ãƒ¬ãƒƒãƒˆãƒ»ãƒªãƒãƒ¼', 'ã‚¯ãƒ¬ã‚¢ãƒ»ãƒ´ã‚¡ãƒ¬ãƒ¼'],
  'ãã®ä»–': ['ãã®ä»–ã®åœ°åŸŸ']
};

// ãƒ¯ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—åˆ¥æ°—å€™é¸æŠè‚¢
const WINE_CLIMATES: Record<WineType, string[]> = {
  red: ['å¤§é™¸æ€§æ°—å€™', 'åœ°ä¸­æµ·æ€§æ°—å€™', 'æµ·æ´‹æ€§æ°—å€™', 'æ¸©å¸¯æ°—å€™', 'å†·æ¶¼æ°—å€™'],
  white: ['å†·æ¶¼æ°—å€™', 'æ¸©å¸¯æ°—å€™', 'å¤§é™¸æ€§æ°—å€™', 'åœ°ä¸­æµ·æ€§æ°—å€™', 'æµ·æ´‹æ€§æ°—å€™'],
  rose: ['åœ°ä¸­æµ·æ€§æ°—å€™', 'æ¸©å¸¯æ°—å€™', 'æµ·æ´‹æ€§æ°—å€™', 'å¤§é™¸æ€§æ°—å€™'],
  sparkling: ['å†·æ¶¼æ°—å€™', 'å¤§é™¸æ€§æ°—å€™', 'æµ·æ´‹æ€§æ°—å€™', 'æ¸©å¸¯æ°—å€™'],
  dessert: ['åœ°ä¸­æµ·æ€§æ°—å€™', 'æ¸©å¸¯æ°—å€™', 'å¤§é™¸æ€§æ°—å€™', 'äºœç†±å¸¯æ°—å€™'],
  fortified: ['åœ°ä¸­æµ·æ€§æ°—å€™', 'æ¸©å¸¯æ°—å€™', 'æµ·æ´‹æ€§æ°—å€™', 'å¤§é™¸æ€§æ°—å€™']
};
```

### 3.3 ã‚°ãƒ©ã‚¹ã‚¿ã‚¤ãƒ—å®šç¾©
```typescript
interface GlassType {
  id: string;
  name: string;
  description: string;
  imageUrl: string;
  characteristics: string[];
  suitableFor: WineType[];
  volume: number;
  manufacturer?: string;
}

const GLASS_TYPES: GlassType[] = [
  {
    id: 'bordeaux',
    name: 'ãƒœãƒ«ãƒ‰ãƒ¼ã‚°ãƒ©ã‚¹',
    description: 'å¤§ã¶ã‚Šã§èƒŒã®é«˜ã„ãƒœã‚¦ãƒ«ã€‚ãƒ•ãƒ«ãƒœãƒ‡ã‚£ã®èµ¤ãƒ¯ã‚¤ãƒ³ç”¨',
    imageUrl: '/images/glasses/bordeaux.webp',
    characteristics: ['å¤§å®¹é‡', 'ç¸¦é•·ãƒœã‚¦ãƒ«', 'ã‚¿ãƒ³ãƒ‹ãƒ³å¯¾å¿œ'],
    suitableFor: ['red'],
    volume: 650,
    manufacturer: 'Riedel'
  },
  {
    id: 'burgundy',
    name: 'ãƒ–ãƒ«ã‚´ãƒ¼ãƒ‹ãƒ¥ã‚°ãƒ©ã‚¹',
    description: 'ãƒœã‚¦ãƒ«ãŒåºƒãæµ…ã„ã€‚ç¹Šç´°ãªèµ¤ãƒ¯ã‚¤ãƒ³ç”¨',
    imageUrl: '/images/glasses/burgundy.webp',
    characteristics: ['åºƒã„ãƒœã‚¦ãƒ«', 'é¦™ã‚Šæ‹¡æ•£', 'ç¹Šç´°ãªãƒ¯ã‚¤ãƒ³ç”¨'],
    suitableFor: ['red'],
    volume: 700,
    manufacturer: 'Riedel'
  },
  {
    id: 'chardonnay',
    name: 'ã‚·ãƒ£ãƒ«ãƒ‰ãƒã‚°ãƒ©ã‚¹',
    description: 'ä¸­ç¨‹åº¦ã®ãƒœã‚¦ãƒ«ã€‚æ¨½ç†Ÿæˆç™½ãƒ¯ã‚¤ãƒ³ç”¨',
    imageUrl: '/images/glasses/chardonnay.webp',
    characteristics: ['ä¸­ç¨‹åº¦ãƒœã‚¦ãƒ«', 'æ¨½é¦™å¯¾å¿œ', 'è¤‡é›‘æ€§è¡¨ç¾'],
    suitableFor: ['white'],
    volume: 580,
    manufacturer: 'Riedel'
  },
  {
    id: 'sauvignon',
    name: 'ã‚½ãƒ¼ãƒ´ã‚£ãƒ‹ãƒ¨ãƒ³ãƒ»ãƒ–ãƒ©ãƒ³ã‚°ãƒ©ã‚¹',
    description: 'å°ã•ã‚ã®ãƒœã‚¦ãƒ«ã€‚ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãªç™½ãƒ¯ã‚¤ãƒ³ç”¨',
    imageUrl: '/images/glasses/sauvignon.webp',
    characteristics: ['å°ã•ã‚ãƒœã‚¦ãƒ«', 'ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã•ä¿æŒ', 'é…¸å‘³å¼·èª¿'],
    suitableFor: ['white'],
    volume: 440,
    manufacturer: 'Riedel'
  },
  {
    id: 'flute',
    name: 'ãƒ•ãƒ«ãƒ¼ãƒˆã‚°ãƒ©ã‚¹',
    description: 'ç´°é•·ã„å½¢çŠ¶ã€‚ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒªãƒ³ã‚°ãƒ¯ã‚¤ãƒ³ç”¨',
    imageUrl: '/images/glasses/flute.webp',
    characteristics: ['ç´°é•·å½¢çŠ¶', 'æ³¡æŒç¶š', 'ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆ'],
    suitableFor: ['sparkling'],
    volume: 300,
    manufacturer: 'Schott Zwiesel'
  },
  {
    id: 'coupe',
    name: 'ã‚¯ãƒ¼ãƒ—ã‚°ãƒ©ã‚¹',
    description: 'æµ…ã„çš¿çŠ¶ã€‚ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒªãƒ³ã‚°ç”¨',
    imageUrl: '/images/glasses/coupe.webp',
    characteristics: ['æµ…ã„çš¿çŠ¶', 'ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸æ„Ÿ', 'é¦™ã‚Šæ‹¡æ•£'],
    suitableFor: ['sparkling'],
    volume: 240,
    manufacturer: 'Baccarat'
  },
  {
    id: 'dessert',
    name: 'ãƒ‡ã‚¶ãƒ¼ãƒˆãƒ¯ã‚¤ãƒ³ã‚°ãƒ©ã‚¹',
    description: 'å°ã•ã‚ã®ãƒœã‚¦ãƒ«ã€‚ç”˜å£ãƒ¯ã‚¤ãƒ³ç”¨',
    imageUrl: '/images/glasses/dessert.webp',
    characteristics: ['å°å®¹é‡', 'é›†ä¸­æ„Ÿ', 'ç”˜å‘³ãƒãƒ©ãƒ³ã‚¹'],
    suitableFor: ['dessert', 'fortified'],
    volume: 190,
    manufacturer: 'Riedel'
  },
  {
    id: 'universal',
    name: 'ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚°ãƒ©ã‚¹',
    description: 'æ±ç”¨æ€§ã®é«˜ã„æ¨™æº–çš„ãªãƒ¯ã‚¤ãƒ³ã‚°ãƒ©ã‚¹',
    imageUrl: '/images/glasses/universal.webp',
    characteristics: ['æ±ç”¨æ€§', 'ãƒãƒ©ãƒ³ã‚¹å‹', 'ã‚³ã‚¹ãƒ‘è‰¯'],
    suitableFor: ['red', 'white', 'rose'],
    volume: 520,
    manufacturer: 'Spiegelau'
  }
];
```

### 3.4 éå»è¨˜éŒ²å¼•ç”¨ã‚·ã‚¹ãƒ†ãƒ 
```typescript
interface PastRecordReference {
  recordId: string;
  wineName: string;
  producer: string;
  vintage?: number;
  rating: number;
  tastingDate: string;
  previewText: string;        // ãƒãƒ¼ãƒˆã®æœ€åˆã®100æ–‡å­—
  availableFields: string[];  // å¼•ç”¨å¯èƒ½ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  citationCount: number;      // è¢«å¼•ç”¨å›æ•°
}

interface CitationPreview {
  sourceRecord: PastRecordReference;
  selectedFields: string[];
  previewData: Partial<TastingRecord>;
  conflictFields: string[];   // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ç«¶åˆã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  estimatedSaveTime: number;  // æ¨å®šå…¥åŠ›æ™‚é–“çŸ­ç¸®ï¼ˆç§’ï¼‰
}

interface CitationHistory {
  citationId: string;
  sourceRecordId: string;
  targetRecordId: string;
  citedFields: string[];
  citationType: 'full' | 'partial' | 'reference';
  citedAt: Date;
  userModified: boolean;      // å¼•ç”¨å¾Œã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†ã—ãŸã‹
}
```

## 4. èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

### 4.1 AuthContext è©³ç´° (`contexts/AuthContext.tsx`)
```typescript
interface AuthContextType {
  currentUser: FirebaseUser | null;
  userProfile: User | null;
  loading: boolean;
  signInWithGoogle: () => Promise<UserCredential>;
  signInWithGoogleAndMigrateData: () => Promise<void>;
  logout: () => Promise<void>;
  hasGuestData: () => boolean;
  getGuestDataSummary: () => GuestDataSummary;
}

interface GuestDataSummary {
  totalRecords: number;
  totalQuizAttempts: number;
  achievements: string[];
}
```

**ä¸»è¦æ©Ÿèƒ½**:
- **Google OAuth**: å˜ä¸€èªè¨¼æ–¹å¼
- **ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰**: localStorage ã«ã‚ˆã‚‹ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ä¿å­˜
- **ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ**: ã‚²ã‚¹ãƒˆ â†’ èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªå‹•ç§»è¡Œ
- **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«åŒæœŸ**: Firebase User â†’ Firestore User ã®è‡ªå‹•åŒæœŸ
- **XPè¨ˆç®—**: ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®è‡ªå‹•ãƒ¬ãƒ™ãƒ«åˆ¤å®š

## 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 

### 6.1 ä¸­å¤®é›†æ¨©çš„ã‚¨ãƒ©ãƒ¼ç®¡ç† (`contexts/ErrorContext.tsx`)
```typescript
interface AppError {
  id: string;
  type: 'network' | 'auth' | 'validation' | 'server' | 'unknown';
  message: string;          // æŠ€è¡“çš„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  userMessage: string;      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  timestamp: number;
  retry?: () => Promise<void>;
  autoRetry: boolean;
  details?: any;
}
```

**æ©Ÿèƒ½**:
- **Firebase ã‚¨ãƒ©ãƒ¼åˆ†é¡**: è‡ªå‹•çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¤‰æ›
- **ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½**: æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã«ã‚ˆã‚‹è‡ªå‹•å†è©¦è¡Œ
- **è‡ªå‹•ç ´æ£„**: éã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚¨ãƒ©ãƒ¼ã®10ç§’è‡ªå‹•å‰Šé™¤
- **å›å¾©å¯èƒ½æ€§**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã«å¯¾ã™ã‚‹ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒªãƒˆãƒ©ã‚¤

### 6.2 ã‚¨ãƒ©ãƒ¼è¿½è·¡æº–å‚™ (`services/errorTrackingService.ts`)
```typescript
interface ErrorTrackingConfig {
  environment: 'development' | 'production';
  release: string;
  userId?: string;
  tags?: Record<string, string>;
}
```

**Sentryçµ±åˆæº–å‚™**:
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³è¿½è·¡**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±**: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®è©³ç´°ãªçŠ¶æ³
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**: ãƒ•ãƒƒã‚¯æº–å‚™æ¸ˆã¿
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

## 7. é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

### 7.1 ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ (`services/notificationService.ts`)
```typescript
interface NotificationConfig {
  types: {
    streak_reminder: boolean;
    quiz_reminder: boolean;
    badge_earned: boolean;
    weekly_summary: boolean;
    heart_recovery: boolean;
    friend_activity: boolean;
  };
  quietHours: {
    start: string;          // "22:00"
    end: string;            // "08:00"
    enabled: boolean;
  };
  frequency: 'high' | 'medium' | 'low';
}
```

### 7.2 ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ (`services/notificationScheduler.ts`)
```typescript
interface ScheduledNotification {
  type: NotificationType;
  scheduledFor: Date;
  userId: string;
  payload: NotificationPayload;
  recurring?: {
    pattern: 'daily' | 'weekly';
    interval: number;
  };
}
```

**æ©Ÿèƒ½**:
- **ã‚¹ãƒãƒ¼ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ´»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
- **é™å¯‚æ™‚é–“**: å¤œé–“é€šçŸ¥ã®è‡ªå‹•å›é¿
- **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆã«åŸºã¥ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **Service Workerçµ±åˆ**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é€šçŸ¥å‡¦ç†

## 8. ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

### 8.1 XPã‚·ã‚¹ãƒ†ãƒ  (`services/gamificationService.ts`)
```typescript
const XP_REWARDS = {
  WINE_RECORD_QUICK: 10,
  WINE_RECORD_DETAILED: 20,
  QUIZ_CORRECT: 5,
  DAILY_GOAL_COMPLETE: 50,
  BADGE_EARNED: 100,
  STREAK_BONUS: 10,         // æœ€å¤§10æ—¥é–“
};

// ãƒ¬ãƒ™ãƒ«è¨ˆç®—: æŒ‡æ•°é€²è¡Œï¼ˆ1.2å€ï¼‰
function calculateLevel(xp: number): number {
  // ãƒ™ãƒ¼ã‚¹: 100 XP, å„ãƒ¬ãƒ™ãƒ«+20%
}
```

### 8.2 ãƒãƒƒã‚¸ã‚·ã‚¹ãƒ†ãƒ  (`data/badges.ts`)
```typescript
// 67å€‹ã®ãƒãƒƒã‚¸ï¼ˆ4ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼‰
{
  recording: 12æ®µéš,      // 1, 3, 5, 10, 25, 50, 100, 200, 500, 1000, 2000, 5000æœ¬
  streak: 10æ®µéš,         // 3, 7, 14, 30, 50, 100, 200, 365, 500, 1000æ—¥
  quiz: 15æ®µéš,           // å®Œèµ°ãƒ»ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒ»æ­£è§£æ•°
  exploration: 30æ®µéš     // å›½ãƒ»å“ç¨®ãƒ»ä¾¡æ ¼å¸¯ãƒ»å¹´ä»£ã®å¤šæ§˜æ€§
}
```

### 8.3 æ—¥å¸¸ç›®æ¨™ã‚·ã‚¹ãƒ†ãƒ 
```typescript
interface DailyGoal {
  userId: string;
  date: string;             // YYYY-MM-DD
  wineRecordingGoal: number;
  quizGoal: number;
  wineRecordingCompleted: number;
  quizCompleted: number;
  xpEarned: number;
}
```

## 9. ã‚¯ã‚¤ã‚ºã‚·ã‚¹ãƒ†ãƒ ï¼ˆå®Ÿè£…å®Œäº†ï¼‰

### 9.1 å•é¡Œæ§‹æˆ
- **ç·å•é¡Œæ•°**: 20ãƒ¬ãƒ™ãƒ« Ã— 100å• = 2,000å•
- **å•é¡Œå½¢å¼**: 4æŠé¸æŠå¼ï¼ˆé¸æŠè‚¢é…åˆ— + æ­£è§£ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ + è§£èª¬ï¼‰
- **å•é¡ŒIDå½¢å¼**: `L{ãƒ¬ãƒ™ãƒ«}_{3æ¡é€£ç•ª}` (ä¾‹: L01_001, L15_087)

### 9.2 ãƒ¬ãƒ™ãƒ«åˆ¥ã‚¸ãƒ£ãƒ³ãƒ«è©³ç´°
```typescript
// 20ãƒ¬ãƒ™ãƒ«ã®è©³ç´°åˆ†é¡
export const QUIZ_LEVELS = [
  // åˆå¿ƒè€…ãƒ¬ãƒ™ãƒ«ï¼ˆ1-5ï¼‰
  { level: 1, name: 'ãƒ¯ã‚¤ãƒ³ã®åŸºæœ¬', description: 'èµ¤ãƒ»ç™½ãƒ»ãƒ­ã‚¼ãƒ»ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒªãƒ³ã‚°' },
  { level: 2, name: 'ä¸»è¦ãƒ–ãƒ‰ã‚¦å“ç¨®', description: 'å›½éš›å“ç¨®ä¸­å¿ƒ' },
  { level: 3, name: 'åŸºæœ¬çš„ãªãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°æŠ€æ³•', description: 'ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®åŸºç¤' },
  { level: 4, name: 'ãƒ¯ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ãƒãƒŠãƒ¼', description: 'ã‚µãƒ¼ãƒ“ã‚¹ã®åŸºæœ¬' },
  { level: 5, name: 'åŸºæœ¬çš„ãªãƒ•ãƒ¼ãƒ‰ãƒšã‚¢ãƒªãƒ³ã‚°', description: 'æ–™ç†ã¨ã®ç›¸æ€§' },
  
  // ä¸­ç´šè€…ãƒ¬ãƒ™ãƒ«ï¼ˆ6-10ï¼‰
  { level: 6, name: 'ãƒ•ãƒ©ãƒ³ã‚¹ãƒ¯ã‚¤ãƒ³åŸºç¤', description: 'ä¸»è¦ç”£åœ°' },
  { level: 7, name: 'ã‚¤ã‚¿ãƒªã‚¢ãƒ»ãƒ‰ã‚¤ãƒ„ãƒ»ã‚¹ãƒšã‚¤ãƒ³ãƒ¯ã‚¤ãƒ³', description: 'æ¬§å·ä¸‰å¤§ç”£åœ°' },
  { level: 8, name: 'æ–°ä¸–ç•Œãƒ¯ã‚¤ãƒ³', description: 'ã‚¢ãƒ¡ãƒªã‚«ãƒ»ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ç­‰' },
  { level: 9, name: 'ãƒ¯ã‚¤ãƒ³è£½é€ æŠ€è¡“è©³ç´°', description: 'é†¸é€ ãƒ—ãƒ­ã‚»ã‚¹' },
  { level: 10, name: 'ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ã¨ç†Ÿæˆ', description: 'å¹´ä»£ã¨ç†Ÿæˆ' },
  
  // ä¸Šç´šè€…ãƒ¬ãƒ™ãƒ«ï¼ˆ11-15ï¼‰
  { level: 11, name: 'ãƒ•ãƒ©ãƒ³ã‚¹å„åœ°æ–¹è©³ç´°', description: 'ãƒœãƒ«ãƒ‰ãƒ¼ãƒ»ãƒ–ãƒ«ã‚´ãƒ¼ãƒ‹ãƒ¥' },
  { level: 12, name: 'ä¸–ç•Œå„å›½ã®ãƒ¯ã‚¤ãƒ³æ³•è¦åˆ¶', description: 'æ³•å¾‹ã¨è¦åˆ¶' },
  { level: 13, name: 'ãƒ—ãƒ­ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰æŠ€æ³•', description: 'ä¸Šç´šãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°' },
  { level: 14, name: 'ç¨€å°‘å“ç¨®ãƒ»ãƒã‚¤ãƒŠãƒ¼ç”£åœ°', description: 'çã—ã„å“ç¨®ã¨ç”£åœ°' },
  { level: 15, name: 'ãƒ¯ã‚¤ãƒ³ãƒ“ã‚¸ãƒã‚¹ãƒ»æµé€š', description: 'ãƒ“ã‚¸ãƒã‚¹å´é¢' },
  
  // ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ï¼ˆ16-20ï¼‰
  { level: 16, name: 'æ­´å²çš„ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ãƒ»ä¼èª¬çš„ãƒ¯ã‚¤ãƒ³', description: 'æ­´å²ã¨ä¼èª¬' },
  { level: 17, name: 'æœ€æ–°é†¸é€ æŠ€è¡“ãƒ»ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³', description: 'æŠ€è¡“é©æ–°' },
  { level: 18, name: 'ãƒ¯ã‚¤ãƒ³æŠ•è³‡ãƒ»ãƒ“ã‚¸ãƒã‚¹ç†è«–', description: 'æŠ•è³‡ã¨çµŒå–¶' },
  { level: 19, name: 'ç·åˆé…’é¡çŸ¥è­˜', description: 'æ—¥æœ¬é…’ãƒ»ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ç­‰' },
  { level: 20, name: 'ãƒ¯ã‚¤ãƒ³å“²å­¦ãƒ»å¿ƒç†å­¦ãƒ»æ–‡åŒ–è«–', description: 'æ–‡åŒ–ã¨å¿ƒç†' }
]
```

### 9.3 å•é¡Œãƒ‡ãƒ¼ã‚¿å½¢å¼
```typescript
interface QuizQuestion {
  id: string;               // ä¾‹: 'L01_001'
  category: string;         // ãƒ¬ãƒ™ãƒ«åã¨åŒã˜
  question: string;         // å•é¡Œæ–‡
  options: string[];        // 4ã¤ã®é¸æŠè‚¢
  correctAnswer: number;    // æ­£è§£ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ0-3ï¼‰
  explanation?: string;     // è§£èª¬ï¼ˆä»»æ„ï¼‰
}

// å®Ÿè£…ä¾‹
{
  id: 'L01_001',
  difficulty: 1,
  category: 'ãƒ¯ã‚¤ãƒ³ã®åŸºæœ¬',
  question: 'ãƒ¯ã‚¤ãƒ³ã®ä¸»ãªåŸæ–™ã¯ä½•ã§ã™ã‹ï¼Ÿ',
  options: ['ç±³', 'ãƒ–ãƒ‰ã‚¦', 'éº¦', 'ã‚Šã‚“ã”'],
  correctAnswer: 1,
  explanation: 'ãƒ¯ã‚¤ãƒ³ã¯ãƒ–ãƒ‰ã‚¦ã‚’ç™ºé…µã•ã›ã¦ä½œã‚‰ã‚Œã‚‹ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«é£²æ–™ã§ã™ã€‚'
}
```

### 9.2 å‹•çš„èª­ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ  (`data/quiz/index.ts`)
```typescript
// ãƒ¬ãƒ™ãƒ«åˆ¥é…å»¶èª­ã¿è¾¼ã¿
const levelImportMap: Record<number, () => Promise<{ default: QuizQuestion[] }>>
const questionCache: Map<number, QuizQuestion[]>

// ä½¿ç”¨ä¾‹
await loadQuestionsByLevel(5);
await loadQuestionsByRange(1, 10);
```

### 9.3 å­¦ç¿’é€²æ—ç®¡ç† (`services/quizProgressService.ts`)
```typescript
interface QuizProgress {
  userId: string;
  difficulty: number;
  completedQuestions: string[];
  correctAnswers: number;
  totalAttempts: number;
  bestScore: number;
  lastPlayedAt: Timestamp;
}

interface UserQuizStats {
  heartsRemaining: number;
  heartsRecoveryTime: Timestamp | null;
  currentStreak: number;
  longestStreak: number;
  overallAccuracy: number;
}
```

**æ©Ÿèƒ½**:
- **ãƒãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ **: 5ãƒ©ã‚¤ãƒ•ã€30åˆ†å›å¾©é–“éš”
- **é–“é•ã„å¾©ç¿’**: é–“éš”åå¾©å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- **ã‚¹ãƒˆãƒªãƒ¼ã‚¯è¿½è·¡**: é€£ç¶šæ­£è§£ã®æ¤œå‡ºã¨å ±é…¬

## 10. é«˜åº¦ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 10.1 ãƒ¯ã‚¤ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ (`components/WineFilter.tsx`)
```typescript
interface WineFilterOptions {
  countries: string[];
  grapeVarieties: string[];
  wineTypes: ('red' | 'white' | 'rose' | 'sparkling' | 'dessert' | 'fortified')[];
  priceRange: { min: number | null; max: number | null; };
  ratingRange: { min: number | null; max: number | null; };
  vintageRange: { min: number | null; max: number | null; };
  searchText: string;
}
```

**æ©Ÿèƒ½**:
- **4ã‚¿ãƒ–UI**: ç¨®é¡ãƒ»ç”£åœ°å“ç¨®ãƒ»ä¾¡æ ¼å¹´ä»£ãƒ»è©•ä¾¡
- **å‹•çš„å€™è£œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãæ¨å¥¨é¸æŠè‚¢
- **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¡¨ç¤º**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚«ã‚¦ãƒ³ãƒˆ
- **ãƒ¬ãƒ³ã‚¸å…¥åŠ›**: åŒæ–¹å‘æ•°å€¤ç¯„å›²æŒ‡å®š

### 10.2 æ‰‹æãã‚­ãƒ£ãƒ³ãƒã‚¹ (`components/DrawingCanvas.tsx`)
```typescript
interface DrawingCanvasProps {
  onSave?: (dataUrl: string) => void;
  width?: number;           // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ400px
  height?: number;          // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ300px
  className?: string;
}
```

**æ©Ÿèƒ½**:
- **æç”»ãƒ„ãƒ¼ãƒ«**: ãƒšãƒ³ãƒ»æ¶ˆã—ã‚´ãƒ åˆ‡ã‚Šæ›¿ãˆ
- **è¨­å®š**: ãƒ–ãƒ©ã‚·ã‚µã‚¤ã‚ºï¼ˆ1-20pxï¼‰ã€ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼
- **å…¥åŠ›å¯¾å¿œ**: ãƒã‚¦ã‚¹ãƒ»ã‚¿ãƒƒãƒã®çµ±ä¸€å‡¦ç†
- **å‡ºåŠ›**: PNGå½¢å¼ã®Data URLç”Ÿæˆ

### 10.3 ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°åˆ†æãƒãƒ£ãƒ¼ãƒˆ (`components/TastingAnalysisCharts.tsx`)
```typescript
// Chart.jsçµ±åˆã«ã‚ˆã‚‹3ç¨®é¡ã®å¯è¦–åŒ–
1. æˆåˆ†ãƒãƒ©ãƒ³ã‚¹: ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
   - è»¸: é…¸å‘³ãƒ»ã‚¿ãƒ³ãƒ‹ãƒ³ãƒ»ç”˜å‘³ãƒ»ãƒœãƒ‡ã‚£ãƒ»ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«æ„Ÿ
   - ã‚¹ã‚±ãƒ¼ãƒ«: 0-10ç‚¹
   
2. é¦™ã‚Šã‚«ãƒ†ã‚´ãƒªãƒ¼: æ£’ã‚°ãƒ©ãƒ•
   - ã‚«ãƒ†ã‚´ãƒªãƒ¼: æœå®Ÿãƒ»èŠ±ãƒ»ã‚¹ãƒ‘ã‚¤ã‚¹ãƒ»ãƒãƒ¼ãƒ–ãƒ»åœŸãƒ»æœ¨ãƒ»ãã®ä»–
   - ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥å›ºæœ‰è‰²
   
3. å‘³ã‚ã„ã®å±•é–‹: ç·šã‚°ãƒ©ãƒ•
   - æ®µéš: ã‚¢ã‚¿ãƒƒã‚¯â†’å±•é–‹â†’ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥
   - ãƒ†ãƒ³ã‚·ãƒ§ãƒ³: 0.4ï¼ˆæ»‘ã‚‰ã‹ãªæ›²ç·šï¼‰
```

### 10.4 ã‚¿ã‚°å…¥åŠ› (`components/TagInput.tsx`)
```typescript
// ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚°ç®¡ç†
- å…¥åŠ›æ–¹å¼: Enter/ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š
- å‰Šé™¤æ©Ÿèƒ½: Backspaceï¼ˆç©ºå…¥åŠ›æ™‚ï¼‰+ å€‹åˆ¥å‰Šé™¤ãƒœã‚¿ãƒ³
- é‡è¤‡é˜²æ­¢: è‡ªå‹•é‡è¤‡ãƒã‚§ãƒƒã‚¯
- ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†: ã‚³ãƒ³ãƒ†ãƒŠã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
```

## 11. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…

### 11.1 Firestore Security Rules (`firestore.rules`)
```typescript
// 181è¡Œã®åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«

// èªè¨¼ãƒ»èªå¯
function isAuthenticated(): request.auth != null
function isOwner(userId): request.auth.uid == userId
function isValidEmail(): request.auth.token.email != null

// ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
function isValidRating(rating): 0 <= rating <= 10
function isValidRecordMode(mode): mode in ['quick', 'detailed']
function isValidWineMasterData(data): å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å­˜åœ¨ãƒã‚§ãƒƒã‚¯
```

**ä¿è­·å¯¾è±¡**:
- **tasting_records**: æ‰€æœ‰è€…é™å®š + å³å¯†ãªå‹æ¤œè¨¼
- **users**: æ‰€æœ‰è€…é™å®š + ä¸å¤‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¿è­·
- **drafts**: æ‰€æœ‰è€…é™å®š + ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆ50ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰

### 11.2 Storage Security Rules (`storage.rules`)
```typescript
// éšå±¤åˆ¥ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
/wine-images/{userId}/: {
  read: public,           // ãƒ¯ã‚¤ãƒ³ç”»åƒã¯å…¬é–‹
  write: owner_only,      // 10MBåˆ¶é™
  formats: ['jpeg', 'png', 'webp']
}

/user-avatars/{userId}/: {
  read: owner_only,       // ã‚¢ãƒã‚¿ãƒ¼ã¯éå…¬é–‹
  write: owner_only,      // 2MBåˆ¶é™
  formats: ['jpeg', 'png', 'webp']
}
```

## 12. PWAæ©Ÿèƒ½å®Ÿè£…

### 12.1 Service Workerè¨­å®š (`vite.config.ts`)
```typescript
// Workboxè©³ç´°è¨­å®š
workbox: {
  navigateFallbackDenylist: [
    /^\/__\/.*$/,           // Firebaseå†…éƒ¨API
    /^\/google\.firestore\.v1/,
    /^.*\.googleapis\.com\//,
    /\.(?:png|jpg|js|css)$/ // é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
  ],
  runtimeCaching: [
    // Firebase Storage: StaleWhileRevalidateï¼ˆ30æ—¥ï¼‰
    // é™çš„ç”»åƒ: CacheFirstï¼ˆ1å¹´ï¼‰
    // ãƒ•ã‚©ãƒ³ãƒˆ: CacheFirstï¼ˆ1å¹´ï¼‰
    // Firebase API: NetworkOnlyï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ï¼‰
  ]
}
```

### 12.2 é€šçŸ¥å‡¦ç† (`firebase-messaging-sw.js`)
```typescript
// ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é€šçŸ¥ã®å‡¦ç†
onBackgroundMessage: {
  title: payload.notification?.title || 'MyWineMemory',
  icon: '/android/mipmap-mdpi/ic_launcher.png',
  actions: [
    { action: 'open', title: 'ã‚¢ãƒ—ãƒªã‚’é–‹ã' },
    { action: 'dismiss', title: 'å¾Œã§' }
  ]
}

// é€šçŸ¥ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
{
  'streak_reminder' â†’ '/select-wine',
  'quiz_reminder' â†’ '/quiz',
  'badge_earned' â†’ '/profile'
}
```

### 12.3 ã‚¢ãƒ—ãƒªãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
```json
{
  "name": "MyWineMemory",
  "short_name": "WineMemory",
  "theme_color": "#722F37",
  "background_color": "#FFF8E1",
  "display": "standalone",
  "orientation": "portrait",
  "categories": ["food", "lifestyle", "education"],
  "icons": [
    // 27ç¨®é¡ã®ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆiOS/Android/PWAå¯¾å¿œï¼‰
    // 48x48 ã€œ 512x512 + SVG
  ]
}
```

## 13. ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…

### 13.1 CSSè¨­è¨ˆ (`App.css`)
```css
/* CSS Custom Properties ã«ã‚ˆã‚‹åŒ…æ‹¬çš„ãƒ†ãƒ¼ãƒ */
:root {
  /* ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ: ãƒãƒ¼é›°å›²æ°— */
  --text-primary: #ffffff;
  --bg-primary: #1a1a1a;
  --card-bg: #2a2a2a;
  --primary-color: #722F37;
}
```

### 13.2 ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–è¨­è¨ˆ
```css
/* å…¨å¹…ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæˆ¦ç•¥ */
.app {
  width: 100vw;
  overflow-x: hidden;
}

.page-container {
  width: 100%;
  max-width: 100vw;
  padding: 1rem;
}

/* ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ: 320pxã€œ */
```

### 13.3 ThemeContext (`contexts/ThemeContext.tsx`)
```typescript
interface ThemeContextType {
  theme: 'light' | 'dark';
  toggleTheme: () => void;
  systemPreference: 'light' | 'dark';
}
```

**æ©Ÿèƒ½**:
- **è‡ªå‹•æ¤œå‡º**: ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®åˆæœŸèª­ã¿è¾¼ã¿
- **æ°¸ç¶šåŒ–**: localStorage ã«ã‚ˆã‚‹è¨­å®šä¿å­˜
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: HTML data-themeå±æ€§ã®å³åº§æ›´æ–°

## 14. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å®Ÿè£…

### 14.1 ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ
```css
/* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç† */
*:focus-visible {
  outline: 2px solid var(--primary-color);
  outline-offset: 2px;
}

/* ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ */
.skip-to-content {
  position: absolute;
  top: -40px;              /* é€šå¸¸æ™‚ã¯éè¡¨ç¤º */
}
```

### 14.2 ARIAå±æ€§ã®æ´»ç”¨
```typescript
// å®Ÿè£…ç®‡æ‰€
- WineFilter: aria-expanded, aria-label
- BottomNavigation: ç¾åœ¨ãƒšãƒ¼ã‚¸ã®è­˜åˆ¥
- LoadingSpinner: aria-live="polite"
- ErrorMessage: role="alert"
```

## 15. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

### 15.1 ãƒ«ãƒ¼ãƒˆæ§‹æˆ (`App.tsx`)
```typescript
// React Router v7ã«ã‚ˆã‚‹å®£è¨€çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
<Routes>
  <Route path="/" element={<Home />} />
  <Route path="/records" element={<Records />} />
  <Route path="/select-wine" element={<SelectWine />} />
  <Route path="/add-tasting-record" element={<AddTastingRecord />} />
  <Route path="/edit-tasting-record/:recordId" element={<AddTastingRecord />} />
  <Route path="/wine-detail/:wineId" element={<WineDetail />} />
  <Route path="/quiz" element={<Quiz />} />
  <Route path="/quiz/play/:difficulty" element={<QuizGame />} />
  <Route path="/stats" element={<Stats />} />
  <Route path="/profile" element={<Profile />} />
  <Route path="/profile/:userId" element={<PublicProfile />} />
</Routes>
```

### 15.2 ãƒœãƒˆãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ (`components/BottomNavigation.tsx`)
```typescript
const navItems = [
  { path: '/', icon: 'ğŸ ', label: 'ãƒ›ãƒ¼ãƒ ' },
  { path: '/records', icon: 'ğŸ“', label: 'è¨˜éŒ²' },
  { path: '/quiz', icon: 'ğŸ§ ', label: 'ã‚¯ã‚¤ã‚º' },
  { path: '/stats', icon: 'ğŸ“Š', label: 'çµ±è¨ˆ' },
  { path: '/profile', icon: 'ğŸ‘¤', label: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«' },
];
```

**æ©Ÿèƒ½**:
- **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹**: ç¾åœ¨ãƒ‘ã‚¹ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: å„ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒ©ãƒ™ãƒ«ä»˜ã‘
- **å›ºå®šé…ç½®**: 80pxé«˜ã•ã§ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã®é–“éš”èª¿æ•´

### 15.3 ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç®¡ç†
```typescript
// ScrollToTop ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
function ScrollToTop() {
  const { pathname } = useLocation();
  useEffect(() => {
    window.scrollTo(0, 0);
  }, [pathname]);
  return null;
}
```

## 16. ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼è©³ç´°

### 16.1 TastingRecord Service (`services/tastingRecordService.ts`)
```typescript
// ä¸»è¦API
interface TastingRecordService {
  // åŸºæœ¬CRUD
  createRecord(userId: string, recordData: Partial<TastingRecord>): Promise<string>;
  getRecord(recordId: string): Promise<TastingRecord | null>;
  updateRecord(recordId: string, updates: Partial<TastingRecord>): Promise<void>;
  deleteRecord(recordId: string): Promise<void>;
  
  // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  searchUserWines(userId: string, searchTerm: string, limit?: number): Promise<TastingRecord[]>;
  getUserRecords(userId: string, filters?: WineFilterOptions): Promise<TastingRecord[]>;
  getPopularWines(userId: string, limit: number): Promise<PopularWine[]>;
  
  // çµ±è¨ˆ
  getUserStats(userId: string): Promise<UserStats>;
  getCountryDistribution(userId: string): Promise<Record<string, number>>;
  
  // ç”»åƒå‡¦ç†
  uploadImages(files: File[], userId: string): Promise<string[]>;
  optimizeImageForUpload(file: File): Promise<File>;
}
```

**é«˜åº¦æ©Ÿèƒ½**:
- **é‡è¤‡æ¤œå‡º**: ãƒ¯ã‚¤ãƒ³åãƒ»ç”Ÿç”£è€…ã«ã‚ˆã‚‹é¡ä¼¼ãƒ¯ã‚¤ãƒ³æ¤œç´¢
- **ç”»åƒæœ€é©åŒ–**: WebPå¤‰æ›ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- **çµ±è¨ˆè¨ˆç®—**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é›†è¨ˆã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **å…¬é–‹è¨˜éŒ²**: ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼åˆ¶å¾¡ä»˜ãã®å…±æœ‰æ©Ÿèƒ½

### 16.2 Gamification Service (`services/gamificationService.ts`)
```typescript
interface GamificationService {
  // XPç®¡ç†
  calculateXP(activityType: string, details?: any): number;
  addXP(userId: string, amount: number, reason: string): Promise<void>;
  
  // ãƒ¬ãƒ™ãƒ«ç®¡ç†
  checkLevelUp(userId: string, newXP: number): Promise<boolean>;
  
  // ã‚¹ãƒˆãƒªãƒ¼ã‚¯ç®¡ç†
  updateStreak(userId: string): Promise<number>;
  checkStreakFreeze(userId: string): Promise<boolean>;
  
  // ãƒãƒƒã‚¸ç®¡ç†
  checkAndAwardBadges(userId: string): Promise<Badge[]>;
  
  // æ—¥å¸¸ç›®æ¨™
  updateDailyGoals(userId: string, activityType: string): Promise<void>;
}
```

## 17. æ–™é‡‘ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå®Ÿè£…äºˆå®šï¼‰

### 17.1 ãƒ—ãƒ©ãƒ³æ¯”è¼ƒ
| æ©Ÿèƒ½ | ç„¡æ–™ãƒ—ãƒ©ãƒ³ | æœ‰æ–™ãƒ—ãƒ©ãƒ³ï¼ˆ500å††/æœˆï¼‰ |
|------|-----------|----------------------|
| **ãƒ¯ã‚¤ãƒ³è¨˜éŒ²** | 1ãƒ¯ã‚¤ãƒ³ã«ã¤ã2è¨˜éŒ²ã¾ã§ | ç„¡åˆ¶é™ |
| **ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰** | 1æšã¾ã§ | 4æšã¾ã§ |
| **è©³ç´°åˆ†æ** | åˆ¶é™ã‚ã‚Š | å…¨æ©Ÿèƒ½ |
| **LLMã‚¯ã‚¤ã‚º** | æœˆ10å›ã¾ã§ | ç„¡åˆ¶é™ |
| **ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ** | ãªã— | CSV/JSON |
| **é«˜åº¦çµ±è¨ˆ** | åŸºæœ¬ã®ã¿ | è©³ç´°åˆ†æ |
ä»Šå¾Œè¿½åŠ äºˆå®šã€‚

### 17.2 Stripeçµ±åˆæ–¹é‡
```typescript
// å®Ÿè£…äºˆå®šã®æ§‹é€ 
interface SubscriptionStatus {
  plan: 'free' | 'premium';
  stripeCustomerId?: string;
  subscriptionId?: string;
  currentPeriodEnd?: Date;
  cancelAtPeriodEnd?: boolean;
}

interface SubscriptionService {
  createCheckoutSession(userId: string, priceId: string): Promise<string>;
  createPortalSession(customerId: string): Promise<string>;
  handleWebhook(event: Stripe.Event): Promise<void>;
  checkSubscriptionStatus(userId: string): Promise<SubscriptionStatus>;
}
```

## 19. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 19.1 é…å»¶èª­ã¿è¾¼ã¿æˆ¦ç•¥
```typescript
// React.lazy ã«ã‚ˆã‚‹å®Œå…¨åˆ†å‰²
const Home = React.lazy(() => import('./pages/Home'));
const SelectWine = React.lazy(() => import('./pages/SelectWine'));
// ...å…¨ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
```

### 19.2 æ¤œç´¢æœ€é©åŒ–
```typescript
// ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ¤œç´¢ï¼ˆ300msï¼‰
useEffect(() => {
  const timeoutId = setTimeout(searchWines, 300);
  return () => clearTimeout(timeoutId);
}, [searchTerm]);
```

### 19.3 ç”»åƒæœ€é©åŒ–
```typescript
// WebPå¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
interface ImageProcessing {
  format: 'webp-first';
  fallback: 'original-format';
  maxSize: 10 * 1024 * 1024;  // 10MB
  compression: 'automatic';
}
```

### 19.4 ãƒãƒ³ãƒ‰ãƒ«åˆ†æ
```typescript
// rollup-plugin-visualizerè¨­å®š
visualizer({
  filename: 'dist/stats.html',
  template: 'treemap',
  gzipSize: true,
  brotliSize: true
})
```

## 20. å›½éš›åŒ–ãƒ»åœ°åŸŸåŒ–

### 20.1 è¨€èªè¨­å®š
- **UIè¨€èª**: æ—¥æœ¬èªå°‚ç”¨
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: è‹±èªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å + æ—¥æœ¬èªã‚³ãƒ³ãƒ†ãƒ³ãƒ„
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: æ—¥æœ¬èªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼
- **é€šçŸ¥**: æ—¥æœ¬èªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### 20.2 åœ°åŸŸåŒ–è¦ç´ 
```typescript
// æ—¥æœ¬å¸‚å ´ç‰¹åŒ–è¨­å®š
{
  currency: 'JPY',
  dateFormat: 'YYYY-MM-DD',
  timeZone: 'Asia/Tokyo',
  numberFormat: '3,000å††'
}
```

## 21. é‹ç”¨ãƒ»ç›£è¦–

### 21.1 ç’°å¢ƒè¨­å®šç®¡ç†
```typescript
// scripts/validate-env.js
å¿…é ˆç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼:
- VITE_FIREBASE_API_KEY
- VITE_FIREBASE_AUTH_DOMAIN
- VITE_FIREBASE_PROJECT_ID
- VITE_FIREBASE_STORAGE_BUCKET
- VITE_FIREBASE_MESSAGING_SENDER_ID
- VITE_FIREBASE_APP_ID
- VITE_FIREBASE_VAPID_KEY
```

### 21.2 ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥
```json
{
  "scripts": {
    "build": "npm run validate:env && tsc -b && vite build",
    "security:check": "npm audit && npm run validate:env",
    "pre-commit": "npm run lint && npm run test && npm run validate:env"
  }
}
```

### 21.3 Firebaseè¨­å®š
```json
// firebase.json
{
  "hosting": {
    "public": "dist",
    "ignore": ["firebase.json", "**/.*", "**/node_modules/**"],
    "rewrites": [{ "source": "**", "destination": "/index.html" }]
  },
  "firestore": {
    "rules": "firestore.rules",
    "indexes": "firestore.indexes.json"
  },
  "storage": {
    "rules": "storage.rules"
  }
}
```

## 22. ãƒ†ã‚¹ãƒˆãƒ»å“è³ªç®¡ç†

### 22.1 ãƒ†ã‚¹ãƒˆè¨­å®š
```typescript
// Jest + Testing Libraryè¨­å®š
{
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/src/test/setup.ts'],
  moduleNameMapping: {
    '\\.(css|less|scss)$': 'identity-obj-proxy'
  }
}
```

### 22.2 å®Ÿè£…æ¸ˆã¿ãƒ†ã‚¹ãƒˆ
- **Component Tests**: ErrorMessage, LoadingSpinner, WineCard
- **Hook Tests**: useErrorHandler
- **Service Tests**: wineMasterService, indexedDBService

### 22.3 å“è³ªç®¡ç†
```typescript
// ESLintè¨­å®š
{
  extends: ['@eslint/js', 'react-hooks', 'react-refresh'],
  rules: {
    'react-hooks/exhaustive-deps': 'warn',
    'react-refresh/only-export-components': 'warn'
  }
}
```

## 23. å°†æ¥æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

### 23.1 ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ©Ÿèƒ½æº–å‚™
- **ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«**: PublicProfile.tsx å®Ÿè£…æ¸ˆã¿
- **è¨˜éŒ²å…±æœ‰**: isPublic ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹åˆ¶å¾¡
- **ã‚¹ãƒ©ãƒƒã‚°æ©Ÿèƒ½**: publicSlug ã«ã‚ˆã‚‹å‹å¥½çš„URL

### 23.2 åˆ†æãƒ»çµ±è¨ˆæ‹¡å¼µ
```typescript
interface UserStats {
  monthlyRecords: { [key: string]: number };
  countryDistribution: { [country: string]: number };
  varietyDistribution: { [variety: string]: number };
  priceRangeAnalysis: object;
  tastingPatterns: object;
}
```

### 23.3 AIæ©Ÿèƒ½çµ±åˆæº–å‚™
- **LLMè©•ä¾¡**: OpenRouter/Groq APIæº–å‚™
- **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºãƒ‰ã‚¯ã‚¤ã‚º**: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨˜éŒ²ãƒ™ãƒ¼ã‚¹å•é¡Œç”Ÿæˆ
- **æ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ **: å‘³è¦šãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åˆ†æ

## 24. ã‚³ã‚¹ãƒˆãƒ»KPIç®¡ç†

### 24.1 é‹ç”¨ã‚³ã‚¹ãƒˆæ§‹é€ 
- **Firebase**: ã€œ800å††/æœˆ
- **LLM API**: ã€œ200å††/æœˆï¼ˆåˆ¶é™ã‚ã‚Šï¼‰
- **ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»SSL**: ã€œ100å††/æœˆ
- **ç·é¡**: 1,100å††/æœˆæœªæº€

### 24.2 æˆåŠŸæŒ‡æ¨™
- **ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ**: MAUã€è¨˜éŒ²é »åº¦ã€ã‚¯ã‚¤ã‚ºç¶™ç¶šç‡
- **ãƒ“ã‚¸ãƒã‚¹**: æœ‰æ–™è»¢æ›ç‡ã€MRRã€CACã€LTV
- **æŠ€è¡“**: åˆæœŸãƒ­ãƒ¼ãƒ‰3ç§’ä»¥å†…ã€PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç‡

## 25. ä¸‰æ®µéšãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

### 25.1 Step 1: ãƒ¯ã‚¤ãƒ³é¸æŠ (`/select-wine`)
```typescript
// SelectWine.tsx ã®æ©Ÿèƒ½
- äººæ°—ãƒ¯ã‚¤ãƒ³è¡¨ç¤ºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ä¸Šä½10ä»¶ï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ï¼ˆ300msãƒ‡ãƒã‚¦ãƒ³ã‚¹ï¼‰
- æ–°è¦ãƒ¯ã‚¤ãƒ³ä½œæˆãƒ•ã‚©ãƒ¼ãƒ 
- TagInput ã«ã‚ˆã‚‹å“ç¨®å…¥åŠ›
- æ—¢å­˜ãƒ¯ã‚¤ãƒ³ã¨ã®é‡è¤‡æ¤œå‡º
```

### 25.2 Step 2: ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ² (`/add-tasting-record`)
```typescript
// AddTastingRecord.tsx ã®æ©Ÿèƒ½
- ã‚¯ã‚¤ãƒƒã‚¯ãƒ»è©³ç´°ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆWebPæœ€é©åŒ–ï¼‰
- è©³ç´°åˆ†æå…¥åŠ›ï¼ˆappearance, aroma, taste, structureï¼‰
- DrawingCanvas çµ±åˆ
- ç’°å¢ƒæƒ…å ±è¨˜éŒ²
```

### 25.3 Step 3: è¨˜éŒ²ç¢ºèª (`/records`, `/wine-detail`)
```typescript
// Records.tsx: ãƒ¯ã‚¤ãƒ³åˆ¥ã‚°ãƒ«ãƒ¼ãƒ—è¡¨ç¤º
- WineFilter ã«ã‚ˆã‚‹é«˜åº¦çµã‚Šè¾¼ã¿
- çµ±è¨ˆæƒ…å ±è¡¨ç¤ºï¼ˆç·è¨˜éŒ²æ•°ã€å¹³å‡è©•ä¾¡ï¼‰
- æ—¥ä»˜ã‚½ãƒ¼ãƒˆã€å…¬é–‹/éå…¬é–‹åˆ‡ã‚Šæ›¿ãˆ

// WineDetail.tsx: å€‹åˆ¥ãƒ¯ã‚¤ãƒ³è©³ç´°
- æ™‚ç³»åˆ—ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°å±¥æ­´
- TastingAnalysisCharts è¡¨ç¤º
- è¨˜éŒ²ã®ç·¨é›†ãƒ»å‰Šé™¤
- ç”»åƒã‚®ãƒ£ãƒ©ãƒªãƒ¼
```

## 26. æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¤œçŸ¥ãƒ»è‡ªå‹•æ›´æ–°ã‚·ã‚¹ãƒ†ãƒ 

### 26.1 Service Workeræ›´æ–°æˆ¦ç•¥
```typescript
// vite.config.ts - æ‹¡å¼µPWAè¨­å®š
workbox: {
  skipWaiting: true,              // æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å³åº§ã«æœ‰åŠ¹åŒ–
  clientsClaim: true,             // ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆ¶å¾¡
  cleanupOutdatedCaches: true,    // å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è‡ªå‹•å‰Šé™¤
  
  runtimeCaching: [
    {
      urlPattern: /\.(?:js|css)$/,
      handler: 'StaleWhileRevalidate',  // å¤ã„ã‚‚ã®ã‚’è¡¨ç¤ºã—ã¤ã¤æ›´æ–°ç¢ºèª
      options: {
        cacheName: 'static-resources',
        expiration: {
          maxEntries: 30,
          maxAgeSeconds: 24 * 60 * 60    // 24æ™‚é–“
        }
      }
    },
    {
      urlPattern: /\.(?:png|jpg|jpeg|svg|gif|webp|ico)$/,
      handler: 'CacheFirst',
      options: {
        cacheName: 'images',
        expiration: {
          maxEntries: 100,
          maxAgeSeconds: 365 * 24 * 60 * 60  // 1å¹´
        }
      }
    }
  ]
}
```

### 26.2 æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¤œçŸ¥ã‚µãƒ¼ãƒ“ã‚¹
```typescript
// services/updateService.ts
interface UpdateService {
  // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
  checkForUpdates(): Promise<boolean>;
  getCurrentVersion(): string;
  getLatestVersion(): Promise<string>;
  
  // æ›´æ–°é€šçŸ¥
  notifyUpdate(options: {
    title: string;
    message: string;
    actions: UpdateAction[];
  }): void;
  
  // è‡ªå‹•æ›´æ–°è¨­å®š
  autoUpdateConfig: {
    checkInterval: number;        // æ›´æ–°ãƒã‚§ãƒƒã‚¯é–“éš”ï¼ˆãƒŸãƒªç§’ï¼‰
    showNotification: boolean;    // é€šçŸ¥è¡¨ç¤ºæœ‰ç„¡
    autoReload: boolean;          // è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰æœ‰ç„¡
    silentUpdate: boolean;        // ã‚µã‚¤ãƒ¬ãƒ³ãƒˆæ›´æ–°
  };
}

// hooks/useUpdateChecker.ts
function useUpdateChecker() {
  const [updateAvailable, setUpdateAvailable] = useState(false);
  const [isUpdating, setIsUpdating] = useState(false);
  
  useEffect(() => {
    // Service Workerç™»éŒ²ã¨æ›´æ–°ç›£è¦–
    registerSW({
      onNeedRefresh() {
        setUpdateAvailable(true);
        showUpdateToast({
          title: 'æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒåˆ©ç”¨å¯èƒ½ã§ã™',
          message: 'ã‚¢ãƒ—ãƒªã‚’æ›´æ–°ã—ã¦æœ€æ–°æ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ãã ã•ã„',
          actions: [
            { label: 'ä»Šã™ãæ›´æ–°', action: 'update' },
            { label: 'å¾Œã§', action: 'dismiss' }
          ]
        });
      },
      onOfflineReady() {
        console.log('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œæº–å‚™å®Œäº†');
      },
      immediate: true
    });
    
    // å®šæœŸçš„ãªæ›´æ–°ãƒã‚§ãƒƒã‚¯ï¼ˆ1æ™‚é–“ã”ã¨ï¼‰
    const interval = setInterval(() => {
      checkForUpdates();
    }, 60 * 60 * 1000);
    
    return () => clearInterval(interval);
  }, []);
  
  const applyUpdate = async () => {
    setIsUpdating(true);
    await updateServiceWorker();
    window.location.reload();
  };
  
  return { updateAvailable, isUpdating, applyUpdate };
}
```

### 26.3 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°
```typescript
// vite.config.ts - ãƒ“ãƒ«ãƒ‰è¨­å®š
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        // ãƒ•ã‚¡ã‚¤ãƒ«åã«ãƒãƒƒã‚·ãƒ¥ã‚’å«ã‚ã‚‹ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ï¼‰
        entryFileNames: 'assets/[name].[hash].js',
        chunkFileNames: 'assets/[name].[hash].js',
        assetFileNames: 'assets/[name].[hash].[ext]'
      }
    },
    manifest: true,    // ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆç”Ÿæˆ
    sourcemap: process.env.NODE_ENV !== 'production'
  },
  
  // ç’°å¢ƒå¤‰æ•°ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
  define: {
    __APP_VERSION__: JSON.stringify(process.env.npm_package_version),
    __BUILD_TIME__: JSON.stringify(new Date().toISOString())
  }
});
```

### 26.4 Firebase Hostingãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
```json
// firebase.json
{
  "hosting": {
    "headers": [
      {
        "source": "**/*.@(js|css)",
        "headers": [{
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"  // ãƒãƒƒã‚·ãƒ¥ä»˜ããƒ•ã‚¡ã‚¤ãƒ«ã¯æ°¸ç¶šã‚­ãƒ£ãƒƒã‚·ãƒ¥
        }]
      },
      {
        "source": "index.html",
        "headers": [{
          "key": "Cache-Control",
          "value": "no-cache, no-store, must-revalidate"  // HTMLã¯å¸¸ã«æœ€æ–°
        }]
      },
      {
        "source": "**/*.@(jpg|jpeg|gif|png|svg|webp)",
        "headers": [{
          "key": "Cache-Control",
          "value": "public, max-age=86400, s-maxage=2592000"  // ç”»åƒã¯1æ—¥/CDN30æ—¥
        }]
      }
    ]
  }
}
```

### 26.5 æ›´æ–°é€šçŸ¥UI
```typescript
// components/UpdateNotification.tsx
interface UpdateNotificationProps {
  version: string;
  changelog?: string[];
  onUpdate: () => void;
  onDismiss: () => void;
}

function UpdateNotification({ version, changelog, onUpdate, onDismiss }: UpdateNotificationProps) {
  return (
    <div className="update-notification" role="alert" aria-live="polite">
      <div className="update-header">
        <span className="update-icon">ğŸ”„</span>
        <h3>ãƒãƒ¼ã‚¸ãƒ§ãƒ³ {version} ãŒåˆ©ç”¨å¯èƒ½ã§ã™</h3>
      </div>
      
      {changelog && (
        <ul className="update-changelog">
          {changelog.map((change, index) => (
            <li key={index}>{change}</li>
          ))}
        </ul>
      )}
      
      <div className="update-actions">
        <button onClick={onUpdate} className="btn-primary">
          ä»Šã™ãæ›´æ–°
        </button>
        <button onClick={onDismiss} className="btn-secondary">
          å¾Œã§é€šçŸ¥
        </button>
      </div>
    </div>
  );
}
```

### 26.6 å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ

#### è‡ªå‹•æ›´æ–°ã®æµã‚Œ:
1. **ãƒ“ãƒ«ãƒ‰æ™‚**: ãƒ•ã‚¡ã‚¤ãƒ«åã«ãƒãƒƒã‚·ãƒ¥ã‚’å«ã‚ã¦ç”Ÿæˆ
2. **ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚**: Firebase Hostingã«æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹æ™‚**: Service WorkerãŒæ›´æ–°ãƒã‚§ãƒƒã‚¯
4. **æ›´æ–°æ¤œçŸ¥æ™‚**: é€šçŸ¥è¡¨ç¤ºã¾ãŸã¯ã‚µã‚¤ãƒ¬ãƒ³ãƒˆæ›´æ–°
5. **æ›´æ–°é©ç”¨**: ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã§æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³æœ‰åŠ¹åŒ–

#### ãƒ¡ãƒªãƒƒãƒˆ:
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ä¸è¦**: ãƒãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹è‡ªå‹•ç„¡åŠ¹åŒ–
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å‘ä¸Š**: æ›´æ–°é€šçŸ¥ã¨é¸æŠçš„æ›´æ–°
- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ**: Service Workerã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: StaleWhileRevalidateæˆ¦ç•¥ã§é«˜é€Ÿè¡¨ç¤º

---

ã“ã®åŒ…æ‹¬çš„æŠ€è¡“ä»•æ§˜æ›¸ã«ã‚ˆã‚Šã€ä»–ã®AIã¯ç¾è¡Œã®å®Ÿè£…ãƒ¬ãƒ™ãƒ«ã‚’æ­£ç¢ºã«ç†è§£ã—ã€é©åˆ‡ãªé–‹ç™ºç¶™ç¶šãƒ»æ©Ÿèƒ½æ‹¡å¼µãƒ»ä¿å®ˆä½œæ¥­ãŒå®Ÿè¡Œå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ã®è©³ç´°ã‹ã‚‰å°†æ¥ã®æ‹¡å¼µæ–¹é‡ã¾ã§ã€å¿…è¦ãªæŠ€è¡“æƒ…å ±ã‚’ç¶²ç¾…ã—ã¦ã„ã¾ã™ã€‚